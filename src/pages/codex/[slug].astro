---
import fs from "fs";
import path from "path";

const CODEX_DIR = path.join(process.cwd(), "starmap/codex");

const { slug } = Astro.params;

// Basic safety: allow only simple slugs you generate
if (!slug || !/^[a-zA-Z0-9._-]+$/.test(slug)) {
  throw new Error("Invalid slug");
}

const filePath = path.join(CODEX_DIR, `${slug}.md`);

// If missing, return a 404
if (!fs.existsSync(filePath)) {
  return new Response("Not Found", { status: 404 });
}

const markdown = fs.readFileSync(filePath, "utf-8");
---

<html>
  <body>
    <a href="/codex">‚Üê Back to Codex</a>
    <h1>{slug}</h1>
    <pre>{markdown}</pre>
  </body>
</html>
